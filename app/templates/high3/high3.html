{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='high3.css') }}">
{% endblock %}

{% block content %}
<div class="high3-container">
    <h1 class="high1-title">고3/N수 입시 분석</h1>
    <p class="high1-sub">목표 대학과 수능/내신 성적을 입력해주세요</p>

    <form action="/high3_result" method="POST" class="form-card high3-wide" id="analysis-form">
        <h3 class="section-title">1. 목표 대학</h3>
        <div class="input-group">
            <select name="school" id="school-select" class="select-box" required>
                <option value="">학교 선택</option>
                {% for school in schools %}
                    <option value="{{ school }}">{{ school }}</option>
                {% endfor %}
            </select>
            <select name="major" id="major-select" class="select-box" required>
                <option value="">학과 선택</option>
            </select>
        </div>

        <div class="score-section">
            <h3 class="section-title">2. 수능/모의고사 성적 (백분위)</h3>
            <div class="score-grid-3">
                <div class="score-item"><label class="label">국어</label><input type="number" name="score_kor" class="score-input" required></div>
                <div class="score-item"><label class="label">수학</label><input type="number" name="score_math" class="score-input" required></div>
                <div class="score-item"><label class="label">영어(등급)</label><input type="number" name="score_eng" class="score-input" min="1" max="9" required></div>
            </div>
        </div>

        <div class="score-section">
            <h3 class="section-title">3. 학생부 내신 (평균 등급)</h3>
            <input type="number" name="score_susi" class="score-input" placeholder="예: 2.3" step="0.01" style="width:100%" required>
        </div>

        <button type="submit" id="start-btn" class="submit-btn" style="margin-top: 20px;">분석 리포트 확인하기</button>
    </form>
</div>

<div class="sticky-bottom-bar">
    <button type="button" id="sticky-start-btn" class="sticky-btn" disabled>합격 분석 시작하기</button>
</div>

<script>
    const majorMap = {{ major_map|tojson }};
    const form = document.getElementById("analysis-form");
    const schoolSelect = document.getElementById("school-select");
    const majorSelect = document.getElementById("major-select");
    const startBtn = document.getElementById("start-btn");
    const stickyBtn = document.getElementById("sticky-start-btn");

    schoolSelect.addEventListener("change", function () {
        const school = this.value;
        majorSelect.innerHTML = '<option value="">학과 선택</option>';
        if (!school) return;
        majorMap[school].forEach(m => {
            const opt = document.createElement("option");
            opt.value = m; opt.innerText = m;
            majorSelect.appendChild(opt);
        });
    });

    form.addEventListener("input", () => {
        stickyBtn.disabled = !form.checkValidity();
    });

    stickyBtn.addEventListener("click", () => form.requestSubmit());

    form.onsubmit = function() {
        const text = "합격 가능성 정밀 분석 중...";
        startBtn.innerHTML = text; stickyBtn.innerHTML = text;
        startBtn.disabled = true; stickyBtn.disabled = true;
    };
</script>
{% endblock %}