{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='high2_result.css') }}">
{% endblock %}

{% block content %}

<div class="report-container">

  <h1 class="page-title">ë¶„ì„ ë¦¬í¬íŠ¸</h1>

  <div class="student-meta">
    {{ data.student_info.school }} Â· {{ data.student_info.major }} ì§€ì› í¬ë§ Â·
    <strong>{{ data.student_info.name }}</strong> í•™ìƒ
  </div>

  <!-- =====================
       ìš”ì•½
       ===================== -->
  <div class="summary-grid">
    <div class="summary-item">
      <label>ìˆ˜ì‹œ í‰ê·  ë“±ê¸‰</label>
      <span>{{ data.score_analysis.average_rank }}</span>
    </div>
    <div class="summary-item">
      <label>ì„±ì  ë³€ë™ì„±</label>
      <span>{{ data.score_analysis.volatility }}</span>
    </div>
    <div class="summary-item">
      <label>í•©ê²© ì˜ˆìƒ í™•ë¥ </label>
      <span class="prob-value">{{ data.score_analysis.pass_probability }}%</span>
    </div>
  </div>

  <!-- =====================
       í•©ê²© í™•ë¥ 
       ===================== -->
  <h2 class="section-title">ğŸ“ˆ í•©ê²© í™•ë¥  ì‹œë®¬ë ˆì´ì…˜</h2>
  <p class="graph-desc">
    ëŒ€í•™ë³„ 50%, 70% ì»·ì„ ë°”íƒ•ìœ¼ë¡œ í•©ê²©ì ì„±ì  ë¶„í¬ë¥¼ ì‚°ì¶œí•œ ê²°ê³¼ì…ë‹ˆë‹¤.
    <b class="green">ì´ˆë¡ìƒ‰ ì˜ì—­</b>ì´ í•©ê²© ê°€ëŠ¥ êµ¬ê°„ì…ë‹ˆë‹¤.
  </p>

  <div class="graph-container">
    <img src="data:image/png;base64,{{ data.visual_data.pass_graph }}" alt="í•©ê²© í™•ë¥  ì‹œë®¬ë ˆì´ì…˜">
  </div>

  <!-- =====================
       ì„±ì  ì¶”ì´
       ===================== -->
  <h2 class="section-title">ğŸ“‰ ì „ê³¼ëª© ì„±ì  ì¶”ì´ ë¶„ì„</h2>
  <p class="graph-desc">
    í•™ë…„Â·í•™ê¸°ë³„ ì„±ì  íë¦„ì„ í†µí•´ ê³¼ëª©ë³„ ê°•ì ê³¼ ì•ˆì •ì„±ì„ ë¶„ì„í•©ë‹ˆë‹¤.
  </p>

  <div class="graph-container">
    <img src="data:image/png;base64,{{ data.visual_data.trend_graph }}" alt="ì„±ì  ì¶”ì´ ê·¸ë˜í”„">
  </div>

  <!-- =====================
       ì§€ì› ê°€ëŠ¥ ëŒ€í•™
       ===================== -->
  <h2 class="section-title">ğŸ« ì§€ì› ê°€ëŠ¥ ëŒ€í•™ ë¦¬ìŠ¤íŠ¸</h2>

  <table class="possible-table">
    <tr>
      <th>í˜„ì¬ ì§€ì› ê°€ëŠ¥</th>
      <td>{{ data.PossibleSchools.current | join(', ') }}</td>
    </tr>
    <tr>
      <th class="future">ì„±ì  ìƒìŠ¹ ì‹œ ê°€ëŠ¥</th>
      <td>{{ data.PossibleSchools.future | join(', ') }}</td>
    </tr>
  </table>

  <!-- =====================
       âœ… ë²„íŠ¼ì€ í•­ìƒ ë…¸ì¶œ
       ===================== -->
  <div class="keyword-cta">
    <button type="button" onclick="openKeywordPopup()">
      ğŸ“Œ ìƒê¸°ë¶€ í‚¤ì›Œë“œ ì¶”ì²œ ë³´ê¸°
    </button>
  </div>

  <!-- =====================
       ì¢…í•© ë¶„ì„
       ===================== -->
  <div class="final-feedback">
    <h4>ğŸ” ì¢…í•© ë¶„ì„ ê²°ê³¼</h4>
    <p>{{ data.feedback }}</p>
  </div>

</div>

<!-- =====================
     ì„¸íŠ¹ í‚¤ì›Œë“œ íŒì—… (ë°ì´í„° ìœ ë¬´ì— ë”°ë¼ ë‚´ìš© ë¶„ê¸°)
     ===================== -->
<div id="keywordPopup" class="popup-overlay" aria-hidden="true">
  <div class="popup-content" role="dialog" aria-modal="true">
    <h3>ğŸ“Œ ìƒê¸°ë¶€ í‚¤ì›Œë“œ ì¶”ì²œ</h3>

    {% if data.possibleStrategy %}
      <p class="popup-desc">
        {{ data.student_info.name }}ë‹˜ë³´ë‹¤ ì„±ì ì´ ë‚®ì§€ë§Œ
        <strong>{{ data.targetschool }}</strong>ì— í•©ê²©í•œ í•™ìƒë“¤ì˜ ìƒê¸°ë¶€ì—
        ë” ìì£¼ ë“±ì¥í•œ í‚¤ì›Œë“œì…ë‹ˆë‹¤.
      </p>

      {% for k, info in data.possibleStrategy.items() %}
      <div class="keyword-row">
        <strong>{{ k }}</strong>
        <span>
          í‰ê·  {{ info.avg }}íšŒ /
          ë‚´ ìƒê¸°ë¶€ {{ info.student }}íšŒ â†’
          {% if info.diff > 0 %}
            í‰ê· ë³´ë‹¤ {{ info.diff }}íšŒ ë” ë“±ì¥
          {% elif info.diff < 0 %}
            í‰ê· ë³´ë‹¤ {{ info.diff | abs }}íšŒ ëœ ë“±ì¥
          {% else %}
            í‰ê· ê³¼ ë™ì¼
          {% endif %}
        </span>
      </div>
      {% endfor %}
    {% else %}
      <p class="popup-desc empty">
        í˜„ì¬ ì¡°ê±´ì—ì„œëŠ” ë¹„êµ ê°€ëŠ¥í•œ í•©ê²©ì ìƒê¸°ë¶€ ë°ì´í„°ê°€ ì—†ì–´
        í‚¤ì›Œë“œ ì¶”ì²œì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.
      </p>
    {% endif %}

    <button class="close-btn" type="button" onclick="closeKeywordPopup()">ë‹«ê¸°</button>
  </div>
</div>

<script>
function openKeywordPopup() {
  const el = document.getElementById("keywordPopup");
  el.style.display = "flex";
  el.setAttribute("aria-hidden", "false");
}

function closeKeywordPopup() {
  const el = document.getElementById("keywordPopup");
  el.style.display = "none";
  el.setAttribute("aria-hidden", "true");
}

// ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
document.addEventListener("click", function(e) {
  const overlay = document.getElementById("keywordPopup");
  if (!overlay) return;
  if (e.target === overlay) closeKeywordPopup();
});

// ESCë¡œ ë‹«ê¸°
document.addEventListener("keydown", function(e) {
  if (e.key === "Escape") closeKeywordPopup();
});
</script>

{% endblock %}
